<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; overflow-x: hidden; }
        
        /* Dynamic Background Blur */
        #bg-blur {
            position: fixed; inset: 0; z-index: 0;
            background-size: cover; background-position: center;
            filter: blur(40px) brightness(0.4);
            transform: scale(1.1);
            transition: background-image 1s ease-in-out;
        }

        /* Animations */
        .fade-up { animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(30px); }
        .zoom-in { animation: zoomIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: scale(0.9); }
        .delay-100 { animation-delay: 0.1s; }
        
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes zoomIn { to { opacity: 1; transform: scale(1); } }

        /* States */
        .loading-state { display: flex; }
        .content-state { display: none; }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center justify-center relative">

    <!-- Ambient Background -->
    <div id="bg-blur"></div>
    <div class="fixed inset-0 bg-black/40 z-0"></div>

    <!-- Back Button -->
    <a href="index.html" class="fixed top-6 left-6 z-50 group cursor-pointer">
        <div class="w-12 h-12 flex items-center justify-center rounded-full bg-white/10 backdrop-blur-xl border border-white/20 text-white shadow-lg transition-all duration-300 group-hover:bg-white/20 group-hover:scale-110 active:scale-95">
            <i class="fa-solid fa-arrow-left"></i>
        </div>
    </a>

    <!-- Main Container -->
    <div class="relative z-10 w-full max-w-4xl p-6 md:p-12">
        
        <!-- LOADER (Visible initially) -->
        <div id="loader" class="loading-state flex-col items-center justify-center min-h-[50vh] text-center">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl text-indigo-500 mb-4"></i>
            <h2 class="text-xl font-bold">Loading Library...</h2>
        </div>

        <!-- CONTENT (Hidden initially) -->
        <div id="content" class="content-state flex-col md:flex-row gap-8 items-center md:items-start">
            
            <!-- Left: Book Cover -->
            <div class="w-2/3 md:w-1/3 max-w-[300px] flex-shrink-0 zoom-in">
                <div class="relative rounded-2xl overflow-hidden shadow-[0_20px_50px_rgba(0,0,0,0.5)] border border-white/10 group">
                    <img id="poster" src="" class="w-full aspect-[2/3] object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                </div>
            </div>

            <!-- Right: Details Panel -->
            <div class="flex-1 w-full bg-white/5 backdrop-blur-2xl border border-white/10 rounded-3xl p-6 md:p-10 shadow-2xl fade-up delay-100">
                
                <div class="flex gap-2 mb-4">
                    <span class="px-3 py-1 rounded-full bg-indigo-500/20 border border-indigo-500/30 text-indigo-300 text-[10px] font-bold uppercase tracking-wider">Book Details</span>
                </div>

                <h1 id="title" class="text-3xl md:text-5xl font-extrabold leading-tight mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white via-indigo-100 to-indigo-300 drop-shadow-sm">
                    ...
                </h1>

                <div class="h-px w-full bg-gradient-to-r from-white/20 to-transparent mb-6"></div>

                <div class="mb-8 max-h-[40vh] overflow-y-auto pr-2 custom-scroll">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                        <i class="fa-solid fa-align-left text-indigo-400"></i> Synopsis
                    </h3>
                    <p id="desc" class="text-gray-300 leading-relaxed font-light text-sm md:text-base">
                        ...
                    </p>
                </div>

                <a id="link" href="#" target="_blank" class="group relative w-full flex items-center justify-center gap-3 bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white py-4 rounded-xl font-bold shadow-[0_10px_30px_-10px_rgba(99,102,241,0.5)] transition-all transform hover:-translate-y-1 active:scale-[0.98]">
                    <span class="relative tracking-wide">READ NOW</span>
                    <i class="fa-solid fa-book-open-reader relative animate-pulse"></i>
                </a>

            </div>
        </div>
    </div>

    <script>
        // 1. SUPABASE CONFIGURATION (Embedded)
        const SUPABASE_URL = 'https://puhcnhgxtqliupofalby.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1aGNuaGd4dHFsaXVwb2ZhbGJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NDU3NDUsImV4cCI6MjA4MjEyMTc0NX0.X4Tx-EAkkC8bmdlybvZ1-R5S_tQNCQyGvkFDbzbM4tI';
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 2. MAIN LOGIC
        window.onload = async function() {
            const id = new URLSearchParams(window.location.search).get('id');

            if (!id) {
                alert("Book ID missing. Returning to library.");
                window.location.href = 'index.html';
                return;
            }

            try {
                // Fetch Data
                const { data, error } = await sb
                    .from('books')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error || !data) throw new Error("Data fetch failed");

                // Update UI
                const img = data.poster_url || 'https://via.placeholder.com/300x450?text=No+Cover';
                
                document.getElementById('poster').src = img;
                document.getElementById('bg-blur').style.backgroundImage = `url('${img}')`; // Ambient BG
                document.getElementById('title').innerText = data.title;
                document.getElementById('desc').innerText = data.description || "No synopsis available.";
                document.getElementById('link').href = data.book_url;

                // Switch Views
                document.getElementById('loader').style.display = 'none';
                document.getElementById('content').style.display = 'flex';

            } catch (err) {
                console.error(err);
                document.getElementById('loader').innerHTML = '<p class="text-red-400">Error loading book details.</p>';
            }
        };
    </script>
</body>
</html>